<!--
This shortcode will include chunk returning WebR instance.

Global shinylive configuration is available in the `_quarto.yaml` file.
-->

## shinylive

::: {.callout-warning appearance="simple"}
## Experimental use!
:::

Modify the code below and run it to see the results.

<!--
we have to put some code upfront
- need to setup repos on r-universe - currently it's not possible to setup this elsewhere (e.g. shinylive config or chunk attribute)
- currently shinylive is using webr@v0.2.2 which is missing a feature of shimming `library()` calls - need to add this manually
--!>
```{r shinylive-constructor, echo=FALSE, results='asis'}
text <- unlist(c(
  "```{shinylive-r}",
  "#| standalone: true",
  "#| viewerHeight: 800",
  "#| components: [viewer, editor]",
  "#| layout: vertical",
  "",
  "# -- WEBR HELPERS --",
  "options(webr_pkg_repos = c(\"r-universe\" = \"https://pharmaverse.r-universe.dev\", getOption(\"webr_pkg_repos\")))",
  "if (packageVersion(\"webr\") < \"0.3.0\") {",
  "  .e <- as.environment(\"webr_shims\")",
  "  .e[[\"library\"]] <- function(pkg, ...) {",
  "    package <- as.character(substitute(pkg))",
  "    if (length(find.package(package, quiet = TRUE)) == 0) {",
  "      webr::install(package)",
  "    }",
  "    base::library(package, character.only = TRUE, ...)",
  "  }",
  "}",
  "",
  "# -- APP CODE --",
  knitr::knit_code$get(c("teal")),
  "```"
))
cat(text, sep = "\n")
```
