---
title: PKCT01
subtitle: Summary Concentration Table
---

------------------------------------------------------------------------

::: panel-tabset
## Data Setup

```{r setup, message=FALSE}
#| code-fold: show

library(scda)
library(dplyr)
library(tern)

adpc <- synthetic_cdisc_dataset("latest", "adpc")

# Helper function
threesigfmt <- function(x, ...) {
  as.character(signif(x, 3))
}
```

## Standard Table (Stats in Columns)

```{r}
# Setting up the data
adpc_1 <- adpc %>%
  mutate(
    NFRLT = as.factor(NFRLT),
    AVALC = as.factor(AVALC)
  ) %>%
  filter(ACTARM %in% c("A: Drug X")) %>%
  mutate(ACTARM = factor(ACTARM, levels = c("A: Drug X"))) %>%
  select(NFRLT, ACTARM, VISIT, AVAL, PARAM, AVALC)

# Row structure
l_rows <- basic_table() %>%
  split_rows_by(
    var = "ACTARM",
    split_label = "Cohort/Treatment",
    label_pos = "topleft"
  ) %>%
  split_rows_by(
    var = "VISIT",
    split_label = "Visit",
    label_pos = "topleft"
  ) %>%
  split_rows_by(
    var = "NFRLT",
    split_label = "Norminal Time from First Dose",
    label_pos = "topleft"
  )

# Column results for numeric values
lyt <- l_rows %>%
  analyze_vars_in_cols(
    vars = c("AVAL", "AVALC", rep("AVAL", 8)),
    .stats = c(
      "n", "n_blq", "mean", "sd", "cv",
      "geom_mean", "geom_cv", # "geom_mean_ci",
      "median", "min", "max"
    ),
    .formats = c(
      n = "xx.",
      n_blq = "xx.",
      mean = threesigfmt,
      sd = threesigfmt,
      cv = "xx.x",
      median = threesigfmt,
      geom_mean = threesigfmt,
      geom_cv = "xx.x",
      min = threesigfmt,
      max = threesigfmt
    ),
    .labels = c(
      n = "n",
      n_blq = "Number\nof\n<LTR/BLQ>s",
      mean = "Mean",
      sd = "SD",
      cv = "CV (%) Mean",
      geom_mean = "Geometric Mean",
      geom_cv = "CV % Geometric Mean",
      median = "Median",
      min = "Minimum",
      max = "Maximum"
    ),
    na_level = "NE"
  )
result <- build_table(lyt, df = adpc_1) %>% prune_table()

# Decorating
main_title(result) <- "Summary of PK Concentrations by Nominal Time and Treatment: PK Evaluable\n Protocol: xxxxx"
subtitles(result) <- paste("Analyte: ", unique(unique(adpc$PARAM)), "Treatment:", unique(unique(adpc$ACTARM)))
main_footer(result) <- "NE: Not Estimable"
result
```

## Teal

```{r teal, message=FALSE}
#| code-fold: show

# In progress
```

{{< include ../../si.qmd >}}

:::
